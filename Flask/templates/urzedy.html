<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Urzedy tabela</title>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script type="text/javascript">

    var zaladujDane = function () {
        var settings = {
            "async": true,
            "crossDomain": true,
            "url": "http://127.0.0.1:5000/urzedy/nazwy",
            "method": "GET",
            "dataType": 'json'
        }
        $.ajax(settings).done(function (response) {
            for (i=0; i < response.length; i++){
                var x = document.getElementById("urzedy_i_okienka");
                var option = document.createElement("option");
                option.text = (JSON.parse(response[i][0]).urzad).concat(": ", JSON.parse(response[i][0]).okienko);
                option.value = JSON.parse(response[i][0]).idgrupy;
                x.add(option);


}})};
    window.onload = zaladujDane();

    var pobierzDane = function () {
        var urzad = $('#urzedy_i_okienka').val();
        var fromd = Date.parse($('#from').val())/1000;
        var tod = Date.parse($('#to').val())/1000;
        var settings = {
            "async": true,
            "crossDomain": true,
            "url": "http://127.0.0.1:5000/urzedy/dane/" + urzad + "/" + fromd + "/" + tod,
            "method": "GET",
            "dataType": 'json'
        }
        $.ajax(settings).done(function (response) {
            var tabela = document.getElementById("tabel");
            tabela.innerHTML='';
            var singleRow=document.createElement('tr');
            singleRow.innerHTML += '<td>' + "Data i godzina" + '</td>';
            singleRow.innerHTML += '<td>' + "Liczba osób w kolejce" + '</td>';
            tabela.appendChild(singleRow);
            for (i=0; i < response.length; i++){
                var singleRow=document.createElement('tr');
                const dateObject = new Date(JSON.parse(response[i][0]).timestamp * 1000)
                const humanDateFormat = dateObject.toLocaleString()
                singleRow.innerHTML += '<td>' + humanDateFormat + '</td>';
                singleRow.innerHTML += '<td>' + JSON.parse(response[i][0]).liczbaklwkolejce + '</td>';
                tabela.appendChild(singleRow);}

})};
    </script>
</head>
<body>
    <nav>
        <ul class="menu">
            <li><a href="{{ url_for('home') }}">Powrót do strony startowej</a></li>
        </ul>
    </nav>

<label for="urzedy_i_okienka">Który urząd i okienko:</label>

<select name="urzedy_i_okienka" id="urzedy_i_okienka">
</select>

<label for="from">Od kiedy pokazywać dane:</label>

<input type="datetime-local" id="from"
       name="from" value="2020-10-31T00:00"
       min="2020-10-01T00:00" max="2020-11-20T00:00">

<label for="to">Do kiedy pokazywać dane:</label>

<input type="datetime-local" id="to"
       name="to" value="2020-11-30T00:00"
       min="2020-10-01T00:00" max="2020-11-30T00:00">

<button onclick="pobierzDane()", id="rob">Rób</button>

    <table id="tabel">

    </table>

</body>
</html>